# –¢–æ–ø-5 –Ω–∞–π–Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—à–∏—Ö –∑–º—ñ–Ω –≤ UI

## 1. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –î—É–±–ª—é–≤–∞–Ω–Ω—è WebGL —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `useSceneCanvas.ts` (966 —Ä—è–¥–∫—ñ–≤) —ñ `SaveSlotBackgroundScene.tsx` (1357 —Ä—è–¥–∫—ñ–≤) –º–∞–ª–∏ –º–∞–π–∂–µ —ñ–¥–µ–Ω—Ç–∏—á–Ω—É –ª–æ–≥—ñ–∫—É

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
- –°—Ç–≤–æ—Ä–µ–Ω–æ `WebGLSceneRenderer` –∫–ª–∞—Å (`src/ui/renderers/utils/WebGLSceneRenderer.ts`)
- –°—Ç–≤–æ—Ä–µ–Ω–æ `applySyncInstructions` —É—Ç–∏–ª—ñ—Ç—É (`src/ui/renderers/utils/webglSync.ts`)
- –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –≤ –æ–±–∏–¥–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∫–æ—Ä–æ—á–µ–Ω–Ω—è –∫–æ–¥—É, —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è WebGL —Ä–µ—Å—É—Ä—Å–∞–º–∏.

---

## 2. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –ì—ñ–≥–∞–Ω—Ç—Å—å–∫–∏–π —Ö—É–∫ `useSceneCanvas`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–û–¥–∏–Ω —Ö—É–∫ (966 —Ä—è–¥–∫—ñ–≤) —Ä–æ–±–∏–≤ –í–°–ï.

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
–†–æ–∑–±–∏—Ç–æ –Ω–∞ –º–µ–Ω—à—ñ –º–æ–¥—É–ª—ñ:
```typescript
// setupWebGLScene() - —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è WebGL (useWebGLSceneSetup.ts)
// usePositionInterpolation.ts - —ñ–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è –ø–æ–∑–∏—Ü—ñ–π —é–Ω—ñ—Ç—ñ–≤/–∫—É–ª—å
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** Pointer interaction –∑–∞–ª–∏—à–µ–Ω–æ —ñ–Ω–ª–∞–π–Ω –≤ useSceneCanvas, –æ—Å–∫—ñ–ª—å–∫–∏:
- Handlers —Ç—ñ—Å–Ω–æ –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ render loop —Ç–∞ canvas lifecycle
- –í–∏–¥—ñ–ª–µ–Ω–Ω—è –≤ –æ–∫—Ä–µ–º–∏–π —Ö—É–∫ –Ω–µ –¥–∞—î –ø–µ—Ä–µ–≤–∞–≥ —á–µ—Ä–µ–∑ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ canvas (–¥–æ—Å—Ç—É–ø–Ω–∏–π —Ç—ñ–ª—å–∫–∏ –≤ useEffect)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `useSceneCanvas.ts` —Å–∫–æ—Ä–æ—á–µ–Ω–æ –∑ 966 –¥–æ ~550 —Ä—è–¥–∫—ñ–≤.

---

## 3. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –ê–Ω—Ç–∏–ø–∞—Ç–µ—Ä–Ω —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó state ‚Üî ref

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í `useSceneRunState.ts` (—Ä—è–¥–∫–∏ 153-179) –±—É–ª–æ 7 –æ–∫—Ä–µ–º–∏—Ö useEffect, —è–∫—ñ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø—ñ—é–≤–∞–ª–∏ state –≤ refs.

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
–û–±'—î–¥–Ω–∞–Ω–æ –≤—Å—ñ 7 useEffect –≤ –æ–¥–∏–Ω –∑ —É—Å—ñ–º–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏:
```typescript
useEffect(() => {
  spellOptionsRef.current = spellOptions;
  automationStateRef.current = automationState;
  necromancerResourcesRef.current = necromancerResources;
  necromancerOptionsRef.current = necromancerOptions;
  unitCountRef.current = unitCount;
  unitTotalHpRef.current = unitTotalHp;
  brickTotalHpRef.current = brickTotalHp;
}, [spellOptions, automationState, necromancerResources, necromancerOptions, unitCount, unitTotalHp, brickTotalHp]);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ–Ω—à–µ overhead (1 useEffect –∑–∞–º—ñ—Å—Ç—å 7), –ø—Ä–æ—Å—Ç—ñ—à–∏–π –∫–æ–¥, —Ç–∞ —Å–∞–º–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å.

---

## 4. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –ù–∞–¥–º—ñ—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å useEffect –≤ SceneScreen.tsx

**–ü—Ä–æ–±–ª–µ–º–∞:**
12 useEffect –∑—ñ —Å–∫–ª–∞–¥–Ω–∏–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ —Ç–∞ –¥—É–±–ª—é–≤–∞–Ω–Ω—è–º –ª–æ–≥—ñ–∫–∏.

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
–û–±'—î–¥–Ω–∞–Ω–æ –ª–æ–≥—ñ—á–Ω–æ –ø–æ–≤'—è–∑–∞–Ω—ñ effects:

1. **UI State Clearing** (4 ‚Üí 1): –û—á–∏—â–µ–Ω–Ω—è hoverContent —Ç–∞ –∑–∞–∫—Ä–∏—Ç—Ç—è –ø–∞—É–∑–∏ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—ñ–≤/—Ç—É—Ç–æ—Ä—ñ–∞–ª—É
2. **Tutorial Monitor** (3 ‚Üí 1): Input bridge, status response, sanity fallback ‚Äî –≤—Å–µ –≤ –æ–¥–Ω–æ–º—É effect

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 12 useEffect ‚Üí 6 useEffect (—Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è –≤–¥–≤—ñ—á—ñ)

---

## 5. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –î—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É —Ç–∞ cleanup

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `applySyncInstructions` –¥—É–±–ª—é–≤–∞–ª–æ—Å—å
- Cleanup WebGL —Ä–µ—Å—É—Ä—Å—ñ–≤ –±—É–≤ —Ä–æ–∑–∫–∏–¥–∞–Ω–∏–π —ñ –¥—É–±–ª—é–≤–∞–≤—Å—è

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
```typescript
// src/ui/renderers/utils/webglSync.ts - applySyncInstructions()
// src/ui/screens/Scene/hooks/useWebGLSceneSetup.ts - —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π cleanup
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- Cleanup –ø–æ–≤–Ω—ñ—Å—Ç—é —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –≤ `setupWebGLScene()` 
- –í—Å—ñ GPU —Ä–µ—Å—É—Ä—Å–∏ –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ –æ—á–∏—â—É—é—Ç—å—Å—è (bullets, rings, particles, whirls, auras, arcs, fire rings)

---

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏

- ‚úÖ ~~**Console.log –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–¥—ñ**~~ ‚Äî –≤–∏–¥–∞–ª–µ–Ω–æ
- **–°–∫–ª–∞–¥–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º—ñ–∂ —Ö—É–∫–∞–º–∏** —á–µ—Ä–µ–∑ refs (–ø—Ä–∏–π–Ω—è—Ç–Ω–æ –¥–ª—è –¥–∞–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏)
- **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó** –¥–ª—è –¥–µ—è–∫–∏—Ö WebGL –æ–ø–µ—Ä–∞—Ü—ñ–π (–Ω–∏–∑—å–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)

---

## –ü–ª–∞–Ω –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è

1. ‚úÖ **–§–∞–∑–∞ 1:** –°—Ç–≤–æ—Ä–∏—Ç–∏ `WebGLSceneRenderer` –∫–ª–∞—Å (–ø—Ä–æ–±–ª–µ–º–∞ #1) ‚Äî –í–ò–ö–û–ù–ê–ù–û
2. ‚úÖ **–§–∞–∑–∞ 2:** –†–æ–∑–±–∏—Ç–∏ `useSceneCanvas` –Ω–∞ –º–µ–Ω—à—ñ –º–æ–¥—É–ª—ñ (–ø—Ä–æ–±–ª–µ–º–∞ #2) ‚Äî –í–ò–ö–û–ù–ê–ù–û
3. ‚úÖ **–§–∞–∑–∞ 3:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó state/ref (–ø—Ä–æ–±–ª–µ–º–∞ #3) ‚Äî –í–ò–ö–û–ù–ê–ù–û
4. ‚úÖ **–§–∞–∑–∞ 4:** –û–±'—î–¥–Ω–∞—Ç–∏ useEffect –≤ SceneScreen (–ø—Ä–æ–±–ª–µ–º–∞ #4) ‚Äî –í–ò–ö–û–ù–ê–ù–û
5. ‚úÖ **–§–∞–∑–∞ 5:** –í–∏–Ω–µ—Å—Ç–∏ —Å–ø—ñ–ª—å–Ω—É –ª–æ–≥—ñ–∫—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É (–ø—Ä–æ–±–ª–µ–º–∞ #5) ‚Äî –í–ò–ö–û–ù–ê–ù–û

---

## üéâ –í–°–Ü 5 –ü–†–û–ë–õ–ï–ú –í–ò–†–Ü–®–ï–ù–û!
