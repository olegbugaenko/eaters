# –ù–∞—Å—Ç—É–ø–Ω—ñ 5 –ø—Ä–æ–±–ª–µ–º –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É UI

## 1. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –î—É–±–ª—é–≤–∞–Ω–Ω—è cleanup –ª–æ–≥—ñ–∫–∏ –≤ SaveSlotBackgroundScene.tsx

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `SaveSlotBackgroundScene.tsx` –º–∞–≤ –≤–ª–∞—Å–Ω—É cleanup –ª–æ–≥—ñ–∫—É (—Ä—è–¥–∫–∏ 1166-1207)
- –¶–µ –¥—É–±–ª—é–≤–∞–ª–æ cleanup –∑ `useWebGLSceneSetup.ts`, –∞–ª–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–æ `setupWebGLScene()`
- –†–∏–∑–∏–∫ memory leaks –ø—Ä–∏ –∑–º—ñ–Ω—ñ cleanup –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
- –î–æ–¥–∞–Ω–æ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤ `setupWebGLScene()`: `{ initBullets?: boolean, initRings?: boolean }`
- `SaveSlotBackgroundScene` —Ç–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `setupWebGLScene(canvas, scene, { initBullets: false, initRings: false })`
- Cleanup –ª–æ–≥—ñ–∫–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ `webglCleanup()`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –í–∏–¥–∞–ª–µ–Ω–æ ~40 —Ä—è–¥–∫—ñ–≤ –¥—É–±–ª—é–≤–∞–Ω–Ω—è cleanup –∫–æ–¥—É
- –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å cleanup –º—ñ–∂ –æ–±–æ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ú–µ–Ω—à–µ —Ä–∏–∑–∏–∫ memory leaks

---

## 2. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –ì—ñ–≥–∞–Ω—Ç—Å—å–∫–∏–π SaveSlotBackgroundScene.tsx (1149 ‚Üí ~120 —Ä—è–¥–∫—ñ–≤)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–û–¥–∏–Ω —Ñ–∞–π–ª –º—ñ—Å—Ç–∏–≤:
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é (—Ä—è–¥–∫–∏ 36-154)
- –£—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è (—Ä—è–¥–∫–∏ 195-905)
- –õ–æ–≥—ñ–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ü–µ–Ω–∏ (title, arch, creatures)
- WebGL setup —Ç–∞ render loop
- Cleanup –ª–æ–≥—ñ–∫—É

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
–†–æ–∑–±–∏—Ç–æ –Ω–∞ –º–æ–¥—É–ª—ñ:
```typescript
// save-slot-scene-config.ts - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (119 —Ä—è–¥–∫—ñ–≤)
// save-slot-scene-utils.ts - —É—Ç–∏–ª—ñ—Ç–∏ –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è (330 —Ä—è–¥–∫—ñ–≤)
// save-slot-scene-layout.ts - –ª–æ–≥—ñ–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è title/arch/creatures (572 —Ä—è–¥–∫–∏)
// SaveSlotBackgroundScene.tsx - —Ç—ñ–ª—å–∫–∏ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑ render loop (~120 —Ä—è–¥–∫—ñ–≤)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–∫–æ—Ä–æ—á–µ–Ω–æ –∑ 1149 –¥–æ ~120 —Ä—è–¥–∫—ñ–≤ (–∑–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞ ~90%)
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –≤–∏–Ω–µ—Å–µ–Ω—ñ –≤ –æ–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- –£—Ç–∏–ª—ñ—Ç–∏ –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏
- –õ–æ–≥—ñ–∫–∞ layout —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∞ —Ç–∞ —Ç–µ—Å—Ç–æ–≤–∞–Ω–∞ –æ–∫—Ä–µ–º–æ
- –õ–µ–≥—à–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ç–∞ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å

---

## 3. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –ù–∞–¥–º—ñ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `any` —Ç–∏–ø—ñ–≤

**–ü—Ä–æ–±–ª–µ–º–∞ (–≤–∏—Ä—ñ—à–µ–Ω–æ):**
96 –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—å `any` —Ç–∏–ø—ñ–≤ –≤ UI –∫–æ–¥—ñ:
- `src/ui/renderers/objects/PlayerUnitObjectRenderer.ts` - 33 –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ‚Üí **0**
- `src/ui/renderers/objects/ExplosionObjectRenderer.ts` - 13 –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—å ‚Üí **0**
- `src/ui/screens/SaveSlotSelect/save-slot-scene-utils.ts` - 14 –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—å ‚Üí **0**

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
1. –†–æ–∑—à–∏—Ä–µ–Ω–æ `RendererLayerBase.anim` —â–æ–± –≤–∫–ª—é—á–∏—Ç–∏ –≤—Å—ñ –ø–æ–ª—è –∑ `PlayerUnitRendererLayerConfig` (`amplitudePercentage`, `axis` –∑ `movement-normal`/`movement-tangent`)
2. –ó–∞–º—ñ–Ω–µ–Ω–æ `(layer as any).requiresModule` –Ω–∞ `layer.requiresModule` (–ø–æ–ª—è –≤–∂–µ —î –≤ –æ–±–æ—Ö —Ç–∏–ø–∞—Ö)
3. –ó–∞–º—ñ–Ω–µ–Ω–æ `(layer.stroke as any).kind` –Ω–∞ `layer.stroke.kind` –∑ type guard –¥–ª—è `RendererLayerStroke`
4. –ó–∞–º—ñ–Ω–µ–Ω–æ `(fill as any).color` –Ω–∞ type guards –¥–ª—è `SceneSolidFill`, `SceneLinearGradientFill`, —Ç–æ—â–æ
5. –î–æ–¥–∞–Ω–æ —ñ–º–ø–æ—Ä—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ç–∏–ø—ñ–≤ (`SceneSolidFill`, `SceneLinearGradientFill`, `SceneRadialGradientFill`, `SceneDiamondGradientFill`)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –ó–º–µ–Ω—à–µ–Ω–æ –∑ 96 –¥–æ ~17 –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—å `any` (–≤–∏–∫–ª—é—á–∏–≤—à–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é)
- –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–æ–±–ª–µ–º–Ω—ñ —Ñ–∞–π–ª–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ
- –ö—Ä–∞—â–∞ —Ç–∏–ø–æ–±–µ–∑–ø–µ–∫–∞, –º–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫ –ø—ñ–¥ —á–∞—Å —Ä–æ–∑—Ä–æ–±–∫–∏

---

## 4. ‚úÖ –í–ò–ö–û–ù–ê–ù–û: –î—É–±–ª—é–≤–∞–Ω–Ω—è render loop –ª–æ–≥—ñ–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞ (–≤–∏—Ä—ñ—à–µ–Ω–æ):**
- `SaveSlotBackgroundScene.tsx` –º–∞–≤ –≤–ª–∞—Å–Ω–∏–π render loop
- `useSceneCanvas.ts` –º–∞–≤ —Å—Ö–æ–∂–∏–π render loop
- –û–±–∏–¥–≤–∞ —Ä–æ–±–ª—è—Ç—å: `setSceneTimelineTimeMs`, `flushChanges`, `applyChanges`, `syncBuffers`, `render`, effects

**–†—ñ—à–µ–Ω–Ω—è (–≤–∏–∫–æ–Ω–∞–Ω–æ):**
–°—Ç–≤–æ—Ä–µ–Ω–æ —Å–ø—ñ–ª—å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é `createWebGLRenderLoop`:
```typescript
// useWebGLRenderLoop.ts
export const createWebGLRenderLoop = (options: CreateWebGLRenderLoopOptions): WebGLRenderLoop
```

–§—É–Ω–∫—Ü—ñ—è –ø—ñ–¥—Ç—Ä–∏–º—É—î callbacks:
- `beforeUpdate` - –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º —Å—Ü–µ–Ω–∏ (–¥–ª—è –∫–∞–º–µ—Ä–∏, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤)
- `afterApplyChanges` - –ø—ñ—Å–ª—è `applyChanges`, –ø–µ—Ä–µ–¥ `syncBuffers` (–¥–ª—è —ñ–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—ó –ø–æ–∑–∏—Ü—ñ–π)
- `afterUpdate` - –ø—ñ—Å–ª—è `syncBuffers`, –ø–µ—Ä–µ–¥ `render` (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
- `beforeEffects` - –ø—ñ—Å–ª—è `render`, –ø–µ—Ä–µ–¥ –µ—Ñ–µ–∫—Ç–∞–º–∏ (–¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É –µ—Ñ–µ–∫—Ç—ñ–≤)
- `afterRender` - –ø—ñ—Å–ª—è –≤—Å—ñ—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ (–¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í–∏–¥–∞–ª–µ–Ω–æ ~80 —Ä—è–¥–∫—ñ–≤ –¥—É–±–ª—é–≤–∞–Ω–Ω—è render loop –∫–æ–¥—É
- –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –ª–æ–≥—ñ–∫–∞ render loop –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ
- –õ–µ–≥—à–µ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏ –∞–±–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É
- –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –º—ñ–∂ –æ–±–æ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

---

## 5. üü° –°–ï–†–ï–î–ù–Ü–ô –ü–†–Ü–û–†–ò–¢–ï–¢: –í–µ–ª–∏–∫—ñ renderer –∫–ª–∞—Å–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `ObjectsRendererManager.ts` - –≤–µ–ª–∏–∫–∏–π –∫–ª–∞—Å (500+ —Ä—è–¥–∫—ñ–≤)
- `PlayerUnitObjectRenderer.ts` - –±–∞–≥–∞—Ç–æ `any` —Ç–∏–ø—ñ–≤ (33 –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)
- –°–∫–ª–∞–¥–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º—ñ–∂ renderer'–∞–º–∏

**–†—ñ—à–µ–Ω–Ω—è:**
- –†–æ–∑–±–∏—Ç–∏ `ObjectsRendererManager` –Ω–∞ –º–µ–Ω—à—ñ –∫–ª–∞—Å–∏ –∑–∞ —Ç–∏–ø–æ–º –æ–±'—î–∫—Ç—ñ–≤
- –í–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ç–∏–ø–∏ –≤ `PlayerUnitObjectRenderer`
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ composition –∑–∞–º—ñ—Å—Ç—å –≤–µ–ª–∏–∫–æ–≥–æ –∫–ª–∞—Å—É

**–ï—Ñ–µ–∫—Ç:** –õ–µ–≥—à–µ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏, –º–µ–Ω—à–µ coupling.

---

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏

- **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å error boundaries** –¥–ª—è WebGL –ø–æ–º–∏–ª–æ–∫
- **–ù–µ–º–∞—î fallback** —è–∫—â–æ WebGL –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π
- **–°–∫–ª–∞–¥–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º—ñ–∂ —Ö—É–∫–∞–º–∏** —á–µ—Ä–µ–∑ refs (–ø—Ä–∏–π–Ω—è—Ç–Ω–æ, –∞–ª–µ –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏)
- **–í–µ–ª–∏–∫—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ VoidCamp** - –º–æ–∂–ª–∏–≤–æ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —Ä–æ–∑–±–∏—Ç—Ç—è

---

## –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏

1. ‚úÖ **–í–ò–ö–û–ù–ê–ù–û:** –ü—Ä–æ–±–ª–µ–º–∞ #1 (cleanup –¥—É–±–ª—é–≤–∞–Ω–Ω—è) - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ
2. ‚úÖ **–í–ò–ö–û–ù–ê–ù–û:** –ü—Ä–æ–±–ª–µ–º–∞ #2 (–≤–µ–ª–∏–∫–∏–π —Ñ–∞–π–ª) - —Ä–æ–∑–±–∏—Ç–æ –Ω–∞ –º–æ–¥—É–ª—ñ
3. ‚úÖ **–í–ò–°–û–ö–ò–ô:** –ü—Ä–æ–±–ª–µ–º–∞ #3 (`any` —Ç–∏–ø–∏) - —Ç–∏–ø–æ–±–µ–∑–ø–µ–∫–∞
4. ‚úÖ **–í–ò–ö–û–ù–ê–ù–û:** –ü—Ä–æ–±–ª–µ–º–∞ #4 (render loop –¥—É–±–ª—é–≤–∞–Ω–Ω—è) - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ
5. üü° **–°–ï–†–ï–î–ù–Ü–ô:** –ü—Ä–æ–±–ª–µ–º–∞ #5 (–≤–µ–ª–∏–∫—ñ renderer –∫–ª–∞—Å–∏) - –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
