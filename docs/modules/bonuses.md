# BonusesModule

## Призначення
Керує всіма числовими бонусами гри. Агрегує ефекти від будівель, скілів, модулів юнітів та інших джерел у єдину таблицю значень.

## Залежності
- `bonuses-db.ts` для конфігурацій бонусів.

## Життєвий цикл
- `initialize()` — обчислює стартові значення й публікує їх.
- `reset()` — обнуляє рівні всіх джерел і переобчислює значення.
- `load()` / `save()` — наразі не зберігає стан (бонуси відтворюються з інших модулів).

## Основні методи
- `registerSource(sourceId, effects)` — реєструє джерело бонусів і нормалізує формули ефектів.
- `unregisterSource(sourceId)` — прибирає джерело з розрахунку.
- `setSourceLevel(sourceId, level)` / `setBonusCurrentLevel` — змінює рівень джерела, запускає переобчислення.
- `getBonusValue(id)` — повертає поточне значення бонусу з урахуванням бази, доходу та множників.
- `getAllValues()` — копія всіх бонусів.
- `getBonusEffects(sourceId)` — повертає попередній перегляд значень для поточного та наступного рівня.
- `subscribe(listener)` — підписка на зміни, одразу надсилає знімок значень.

## Збереження та місток
Модуль сам не пише у DataBridge, але використовується іншими системами для синхронізації (наприклад, майстерня будівель і дерево скілів). Стан не серіалізується — рівні джерел зберігаються у відповідних модулях.
