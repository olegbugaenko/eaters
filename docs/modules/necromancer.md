# NecromancerModule

## Призначення
Контролює ресурси некроманта (мана й sanity), список доступних дизайнів та виклики юнітів під час забігу.

## Залежності
- `DataBridge` — публікує ресурси (`necromancer/resources`) і доступні дизайни (`necromancer/spawnOptions`).
- `PlayerUnitsModule` — спавнить юнітів на полі.
- `SceneObjectManager` — визначає межі карти та клампінг точок виклику.
- `BonusesModule` — змінює ліміти мани/саніті та їх відновлення.
- `UnitDesignModule` — надає список активних дизайнів і їх характеристики.

## Життєвий цикл
- `initialize()` — застосовує бонуси, публікує стартові ресурси та список дизайнів.
- `reset()` — очищує ресурси, скасовує активну карту, оновлює місток.
- `load(data)` — читає збережені значення мани й sanity, застосовує після конфігурації карти.

## Основні методи
- `tick(deltaMs)` — регенерує ману та поступово зменшує sanity, якщо карта активна, та надсилає оновлення. Коли sanity падає до нуля, карта завершується поразкою.
- `configureForMap({ spawnPoints })` — отримує точки спавну, клампить їх до меж карти, скидає показники й застосовує бонуси.
- `trySpawnUnit(type)` — викликає базового юніта, якщо дозволяють ресурси і не перевищено ліміт у 25 юнітів.
- `trySpawnDesign(designId)` — викликає кастомний дизайн; враховує модулі, вартість по мані та обмеження на кількість юнітів.
- `getRemainingUnitCapacity()` / `getAffordableSpawnCount()` — допоміжні методи для автоперезапуску карт, враховують ману та юніт-кап.
- `endCurrentMap()` — завершує карту, зупиняє реген, очищує стан.

## Збереження
- Зберігає поточні значення мани та sanity, які застосовуються після ініціалізації карти.

## Особливості
- Викликає юнітів по черзі через масив точок спавну, додаючи невеликий випадковий зсув (`SPAWN_JITTER_RADIUS`).
- Підтримує підписку на зміни дизайнів, щоб негайно оновити опції виклику.
- Sanity не витрачається на виклики чи закляття; це таймер забігу, який невпинно спливає (0.25 од./с).
