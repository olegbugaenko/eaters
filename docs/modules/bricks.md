# BricksModule

## Призначення
Відповідає за створення, оновлення та руйнування цеглин на карті. Синхронізує сцену, бонуси та винагороди за знищення.

## Залежності
- `SceneObjectManager` — для відображення цеглин та анімацій.
- `DataBridge` — публікує статистику (`bricks/count`, `bricks/totalHp`).
- `ExplosionModule` — спавнить ефекти пошкоджень та знищення.
- `ResourcesModule` — нараховує нагороди за руйнацію.
- `BonusesModule` — враховує множники винагород.

## Життєвий цикл
- `initialize()` — одразу публікує статистику.
- `reset()` — очищує сцену й скидає всі цеглини.
- `load(data)` — читає збережені цеглини (позиція, hp, рівень) і реконструює стан.

## Основні методи
- `setBricks(bricks)` — застосовує новий список цеглин (використовується картами).
- `getBrickStates()` / `getBrickState(id)` — повертають копії стану для інших систем.
- `findNearestBrick(position)` / `findBricksNear(position, radius)` — просторові запити.
- `applyDamage(id, rawDamage, hitDirection, options)` — завдає шкоди, з урахуванням броні, множників та вибухів. Повертає інформацію про знищення.

## Збереження
- Зберігає лише мінімальні дані про цеглини (позиція, тип, hp, рівень). Сцена та просторова сітка реконструюються при завантаженні.

## Створення станів

Модуль використовує `BrickStateFactory` (наслідник `StateFactory`) для створення станів цеглин:

- **`create`**: обчислює характеристики цегли (HP, броня, нагороди, розміри) на основі типу та рівня з бази даних
- **`transform`**: реєструє цеглу в `SceneObjectManager` та додає `sceneObjectId` до стану

Метод `applyBricks` використовує `stateFactory.createWithTransform` для створення та реєстрації цеглин одночасно.

## Особливості
- Використовує `SpatialGrid` для швидких пошуків.
- Має систему віддачі (knockback), яка відтворює анімацію від ударів.
- Підтримує автоперерахунок загального HP кожні 3 секунди, щоб місток не перевантажувався.
- Використовує `StateFactory` для уніфікованого створення станів (див. [state-factory.md](../overview/state-factory.md)).
