# UnitDesignModule

## Призначення
Дозволяє створювати, редагувати й видаляти кастомні дизайни юнітів, розраховує їх статистику та синхронізує її з UI.

## Залежності
- `DataBridge` — публікує стан майстерні (`unitDesigner/state`).
- `BonusesModule` — впливає на обчислені статистики та витрати.
- `UnitModuleWorkshopModule` — надає рівні модулів і сповіщає про оновлення.
- `player-units-db.ts`, `unit-modules-db.ts` — конфіги базових типів і модулів.

## Життєвий цикл
- `initialize()` — підписується на бонуси та майстерню модулів, створює дефолтні дизайни й публікує стан.
- `reset()` / `load(data)` — очищує поточні дизайни, застосовує сейв, потім генерує дефолтні, якщо список порожній.

## Основні методи
- `createDesign(type)` — створює новий дизайн для зазначеного типу.
- `updateDesign(id, patch)` — змінює назву, список модулів або тип.
- `deleteDesign(id)` — видаляє дизайн (також прибирає його з активного ростеру).
- `setActiveRoster(roster)` — задає список дизайнів, які доступні у забігу.
- `getDesign(id)` / `getAllDesigns()` / `getActiveRosterDesigns()` — надають поточні стани.
- `getDefaultDesignForType(type)` — повертає шаблон для базових викликів.
- `subscribe(listener)` — повідомляє UI про будь-які зміни.

## Збереження
- Серіалізує список дизайнів (id, тип, назва, модулі) та активний ростер (до 3 елементів).

## Створення станів

Модуль використовує два StateFactory:

- **`UnitDesignModuleDetailFactory`**: створює стани дизайнів юнітів з обчисленими статистиками
- **`UnitDesignerAvailableModuleFactory`**: створює стани доступних модулів для UI майстерні

Обидва фабрики використовують тільки метод `create` (без `transform`), оскільки стани використовуються тільки для UI та не потребують side effects.

## Особливості
- Обмежує кількість модулів `MAX_MODULES_PER_UNIT` (3) і активних дизайнів `MAX_ACTIVE_UNITS` (3).
- Кешує обчислені статистики, щоб уникати повторних перерахунків при кожній дрібній зміні.
- Якщо ростер порожній, автоматично додає новостворені дизайни, щоб гравець завжди мав мінімальний набір.
- Використовує `StateFactory` для уніфікованого створення станів (див. [state-factory.md](../overview/state-factory.md)).
