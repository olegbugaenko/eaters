# Забіг та карти

## Підготовка
1. **Вибір карти.** У меню відображається список карт із поточним рівнем складності, кількістю спроб та найкращим часом (`MapModule`). Якщо карта заблокована, UnlockService не дозволить її обрати.
2. **Налаштування рівня.** Для кожної карти можна вибрати рівень складності. Гра запам'ятовує останній вибір і автоматично пропонує його наступного разу.
3. **Склад юнітів.** Перед стартом `NecromancerModule` і `PlayerUnitsModule` готують розстановку: активні дизайни та базові юніти завантажуються з сейву.

## Старт забігу
- Після натискання «Старт» `MapModule` викликає `startRun()` у `ResourcesModule` та `prepareForMap()` у `PlayerUnitsModule`. Карта спавнить цеглини, портали та точки входу юнітів.
- Некромант отримує повну шкалу мани й розуму (sanity) та може викликати юнітів через вибір дизайну або базового типу.

## Під час гри
- `PlayerUnitsModule` керує рухом, боєм і цільовими пріоритетами: юніти самі шукають найближчу цеглину й атакують її, використовуючи модулі та бонуси.
- `BricksModule` обробляє пошкодження та вибухи. Знищені цеглини додають ресурси у `ResourcesModule` і можуть спричиняти ланцюгові ефекти.
- Якщо юнітів не лишилось, модуль карт може завершити забіг і ініціювати автоперезапуск, якщо такий увімкнено.

## Завершення
- При успіху або поразці `MapModule` викликає `finishRun()` або `cancelRun()` в ресурсах, оновлює статистику карти та публікує результат.
- Гравець бачить підсумок: час, кількість знищених цеглин, зароблені ресурси. Ці значення доступні через місток у вигляді ключів `resources/runSummary` та `maps/autoRestart`.

## Автоперезапуск
- Після вивчення скіла `autorestart_rituals` відкривається меню автоперезапуску. Можна ввімкнути повторний старт або встановити поріг ефективних юнітів (живі + доступні для виклику).
- Якщо поріг не досягнуто, `MapModule` автоматично завершує забіг із поразкою, після чого запускає нову спробу.
